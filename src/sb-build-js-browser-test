#!/usr/bin/env node
var config = require('./utils/get-config')();
var path = require('path');
var shelljs = require('shelljs');
var browserifyHelper = require('./utils/browserify-helper');

var program = require('commander')
  .version(config.sbVersion)
  .option('-w, --watch', 'incremental rebuild')
  .option('-d, --dist <dir>', 'file to write output to')
  .arguments('<glob>')
  .action(function(src) {
    this.src = src;
  })
  .parse(process.argv);

if (!program.src) {
  program.src = path.join(config.src, 'test', '*.test.js')
}

if (!program.dist) {
  program.dist = path.join(config.dist, 'test');
}

var distFile = path.join(program.dist, config.name + '.test');
browserifyHelper({
  dist: distFile,
  src: program.src,
  standalone: false,
  watch: program.watch
});
console.log('Wrote ' + distFile + '.js');
console.log('Wrote ' + distFile + '.js.map');


